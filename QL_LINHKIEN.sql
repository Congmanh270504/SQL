CREATE DATABASE QL_LINHKIEN
USE QL_LINHKIEN

CREATE TABLE LOAILK
(
MALOAI VARCHAR(20) NOT NULL,
TENLOAI NVARCHAR(30),
CONSTRAINT PK_LOAILK PRIMARY KEY (MALOAI)
)
CREATE TABLE LINHKIEN
(
MALK  VARCHAR(20) NOT NULL,
TENLK  NVARCHAR(30),
NGAYSX DATE,
TGBH INT,
MALOAI VARCHAR(20),
NSX NVARCHAR(20),
DVT NVARCHAR(10),
CONSTRAINT PK_LINHKIEN PRIMARY KEY (MALK),
CONSTRAINT FK_LOAILK_LINHKIEN FOREIGN KEY (MALOAI) REFERENCES LOAILK(MALOAI)
)
CREATE TABLE KHACHHANG
(
MAKH VARCHAR(20) NOT NULL,
TENKH NVARCHAR(30),
DCHI NVARCHAR(40),
DTHOAI VARCHAR(20),
CONSTRAINT PK_KHACHHANG PRIMARY KEY (MAKH)
)
CREATE TABLE HOADON
(
MAHD VARCHAR(20) NOT NULL,
NGAYHD DATE,
MAKH VARCHAR(20),
TONGTIEN MONEY,
CONSTRAINT PK_HOADON PRIMARY KEY (MAHD),
CONSTRAINT FK_HOADON_KHACHHANG FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)
)
CREATE TABLE CHITIETHOADON
(
MAHD VARCHAR(20),
MALK  VARCHAR(20),
SOLUONG INT,
DONGIA MONEY,
CONSTRAINT PK_CHITIETHOADON PRIMARY KEY (MAHD,MALK),
CONSTRAINT FK_CHITIETHOADON_HOADON FOREIGN KEY (MAHD) REFERENCES HOADON(MAHD),
CONSTRAINT FK_CHITIETHOADON_LINHKIEN FOREIGN KEY (MALK) REFERENCES LINHKIEN(MALK)
)
INSERT INTO LOAILK VALUES
('MOU',N'Chuột'),
('LAP',N'Máy tính xách tay'),
('CPU',N'Bộ xử lý'),
('PCX',N'Máy tính để bàn'),
('MAI',N'Mainvoard')
SET DATEFORMAT dmy
INSERT INTO LINHKIEN VALUES
('MOU001',N'Chuột quang có dây','01/01/2014',12,'MOU','Genius',N'Cái'),
('MOU002',N'Chuột quang không dây','04/02/2015',12,'MOU','Mistumi',N'Cái'),
('MOU003',N'Chuột không dây','02/04/2014',24,'MOU','Abroad',N'Cái'),
('CPU001',N'CPU ADM','05/04/2015',24,'CPU','Abroad',N'Cái'),
('CPU002',N'CPU INTEL','07/02/2016',36,'CPU','Mistumi',N'Cái'),
('CPU003',N'CPU ASUS','08/12/2015',36,'CPU','Abroad',N'Cái'),
('MAI001',N'Mainboard ASUS','04/12/2015',36,'MAI','Mistumi',N'Cái'),
('MAI002',N'Mainboard ATXX','03/03/2016',12,'MAI','Mistumi',N'Cái'),
('MAI003',N'Mainboard ACER','14/04/2015',12,'MAI','Genius',N'Cái'),
('PCX001',N'Acer 20144','19/10/2015',12,'PCX','Acer',N'Bộ')


INSERT INTO KHACHHANG VALUES
('KH001',N'Nguyễn Thu Tâm',N'Tây Ninh','0989751723'),
('KH002',N'Đinh Bảo Lộc',N'Lâm Đồng','0918234654'),
('KH003',N'Trần Thanh Điệu',N'TP.Hồ Chí Minh','0978123765'),
('KH004',N'Hồ Tuấn Thành',N'Hà Nội','0909456768'),
('KH005',N'Huỳnh Kim Anhs',N'Khánh Hòa','0932987567')

INSERT INTO HOADON VALUES
('HD001','01/04/2015','KH001',null),
('HD002','15/05/2016','KH005',null),
('HD003','14/06/2016','KH004',null),
('HD004','03/06/2016','KH005',null),
('HD005','05/06/2016','KH001',null),
('HD006','07/07/2016','KH003',null),
('HD007','12/08/2016','KH002',null),
('HD008','25/09/2016','KH003',null)
INSERT INTO CHITIETHOADON VALUES
('HD001','MOU001',2,1000000),
('HD002','MOU002',1,2000000),
('HD003','MOU003',6,3000000),
('HD004','CPU001',5,500000),
('HD005','CPU002',6,5600000),
('HD006','CPU003',3,400000),
('HD006','MAI001',1,200000),
('HD007','MAI002',1,150000),
('HD007','MAI003',2,160000),
('HD007','MOU001',1,1000000),
('HD008','CPU001',2,500000)
--1
UPDATE HOADON
SET TONGTIEN=KQ.TT
FROM (SELECT MAHD,SUM(SOLUONG*DONGIA) AS TT FROM CHITIETHOADON GROUP BY MAHD ) AS KQ
WHERE HOADON.MAHD=KQ.MAHD
--2
SELECT *
FROM LINHKIEN
WHERE NSX=N'Genius' AND DVT=N'Cái'
--3
SELECT *
FROM LINHKIEN
WHERE TGBH=24
--4
SELECT *,MONTH(NGAYHD) AS THANG,YEAR(NGAYHD) AS NAM
FROM HOADON
WHERE MONTH(NGAYHD)=6 AND YEAR(NGAYHD)=2016
--5
SELECT TENLK,DVT
FROM LINHKIEN,CHITIETHOADON
WHERE LINHKIEN.MALK=CHITIETHOADON.MALK AND CHITIETHOADON.DONGIA >1000000
--6
SELECT LINHKIEN.MALK,TENLK,NSX,DVT,NGAYSX
FROM LINHKIEN,HOADON,CHITIETHOADON
WHERE DATEDIFF(DAY,HOADON.NGAYHD,'31/05/2015')>0 AND LINHKIEN.MALK=CHITIETHOADON.MALK AND CHITIETHOADON.MAHD=HOADON.MAHD
--7
SELECT TENKH
FROM HOADON,KHACHHANG
WHERE MONTH(NGAYHD)=6 AND YEAR(NGAYHD)=2016 AND KHACHHANG.MAKH=HOADON.MAKH   AND KHACHHANG.DCHI=N'TP.Hồ Chí Minh'
--8
SELECT SUM(SOLUONG) AS TONGLK
FROM CHITIETHOADON
WHERE CHITIETHOADON.MAHD='HD007'
--9
SELECT TENKH, COUNT(*) AS TONGKH
FROM HOADON,KHACHHANG
WHERE MONTH(NGAYHD)=6 AND YEAR(NGAYHD)=2016 AND KHACHHANG.MAKH=HOADON.MAKH   AND KHACHHANG.DCHI=N'Tây Ninh'
GROUP BY TENKH
--10
SELECT DTHOAI,DCHI
FROM KHACHHANG
WHERE KHACHHANG.MAKH='KH001'
--11
SELECT  COUNT(*) AS TONGKH
FROM HOADON
WHERE MONTH(NGAYHD)=5 AND YEAR(NGAYHD)=2016 
--12
SELECT SUM(HOADON.TONGTIEN) AS TONGHD006
FROM HOADON
WHERE HOADON.MAHD='HD006'
--13
SELECT SUM(TONGTIEN)
FROM HOADON
WHERE HOADON.MAHD='HD005' or HOADON.MAHD='HD007'



